---
title: Gatsby - ğŸ”®Utterances ëŒ“ê¸€ ë‹¤í¬ëª¨ë“œ ì ìš©
category: Gatsby
date: '2023-03-04'
author: ha0peno
slug: gatsby-comment
thumbnail: gatsby-comment.png
---

> ë¸”ë¡œê·¸ì— ëŒ“ê¸€ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê³  ì‹¶ì–´ì„œ ì•Œì•„ë³´ë˜ ì¤‘, ê¹ƒí—™ì˜ `utterances`ë¥¼ ì‚¬ìš©í–ˆë‹¤. <br/>
> ì´ìœ ëŠ” ê¹ƒí—™ì— ë¡œê·¸ì¸ì„ í•´ì•¼ ëŒ“ê¸€ì„ ë‹¬ ìˆ˜ ìˆê³ , ë§ˆí¬ë‹¤ìš´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , ì§ì ‘ êµ¬í˜„í•˜ì§€ ì•Šê³  ì‚½ì…í•´ì„œ ë°”ë¡œ ì‚¬ìš©ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

# Create Repository & Install Utterances
- ìš°ì„  ëŒ“ê¸€ìš© ë ˆí¬ì§€í„°ë¦¬ë¥¼ ìƒˆë¡œ ìƒì„±í•œ ë’¤,
- [Install Utterances](https://github.com/apps/utterances)ì—ì„œ ì•±ì„ ì„¤ì¹˜í•˜ê³  ìƒˆë¡œ ìƒì„±í•œ ë ˆí¬ì§€í„°ë¦¬ë¥¼ ì—°ê²°í•œë‹¤.
- ê·¸ëŸ¼ ì•„ë˜ ìŠ¤í¬ë¦½íŠ¸ê°€ ìƒì„±ëœë‹¤.
```html
<script
  src="https://utteranc.es/client.js"
  repo="ë ˆí¬ì§€íŠ¸ë¦¬ëª…"
  issue-term="pathname"
  theme="github-light"
  crossorigin="anonymous"
  async
></script>
```

# Comment ì»´í¬ë„ŒíŠ¸ ìƒì„±
- ë¦¬ì•¡íŠ¸ëŠ” xssë³´ì•ˆ ì´ìŠˆ ë•Œë¬¸ì— ìœ„ ìŠ¤í¬ë¦½íŠ¸ê°€ ì ìš©ëœ ì»´í¬ë„ŒíŠ¸ë¥¼ ìƒì„±í•´ì¤˜ì•¼í•œë‹¤.
```tsx
import React, { useEffect } from "react"

const COMMENTS_ID = 'comments-container';

export default function Comment() {
  useEffect(() => {
      const script = document.createElement('script');
      script.src = 'https://utteranc.es/client.js';
      script.setAttribute('repo', "ë ˆí¬ì§€íŠ¸ë¦¬ëª…");
      script.setAttribute('issue-term', 'pathname');
      script.setAttribute('theme', 'github-light');
      script.setAttribute('crossorigin', 'anonymous');
      script.async = true;

      const comments = document.getElementById(COMMENTS_ID);
      if (comments) comments.appendChild(script);

      return () => {
          const comments = document.getElementById(COMMENTS_ID);
          if (comments) comments.innerHTML = '';
      };
  }, []);

  return (
      <div id={COMMENTS_ID} />
  );
};
```

# Comment ì»´í¬ë„ŒíŠ¸ ì‚½ì…
- ì›í•˜ëŠ” ìœ„ì¹˜ì— Comment ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚½ì…í•œë‹¤.
- ë‚˜ì˜ ê²½ìš°, ë¸”ë¡œê·¸ ê²Œì‹œê¸€(`{mdx.frontmatter__slug}.tsx`)ì— ì‚½ì…í•´ì£¼ì—ˆëŠ”ë°, <br/>
Antdë¥¼ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì—, Cardì˜ actionsì— ì‚½ì…í•´ì„œ ì¹´ë“œ í•˜ë‹¨ì— ë„£ì–´ì£¼ë„ë¡ í–ˆë‹¤. 
```tsx
    <ContentCard actions = {[<Comment/>]}> // <- ì½”ë©˜íŠ¸ì‚½ì…
        <ITag color="magenta"
            onClick={()=> navigate(`/?category=${frontMatter?.category}`)}
        >
            {frontMatter?.category}
        </ITag>
        <Title>{frontMatter?.title}</Title>
        <div style={{display: 'flex', justifyContent: 'space-between'}}>
            <Text type="secondary">{frontMatter?.date}</Text>
            <Text type="secondary">{frontMatter?.author} ğŸ‘©ğŸ»â€ğŸ’»</Text>
        </div>
        <Divider/>
        <MDXLayout>{children}</MDXLayout>
    </ContentCard>
    {
        headings && anchor &&
        <div style={{marginLeft: 'auto', maxWidth: '200px'}}>
            <Anchor style={{marginTop: '200px'}} items={headings} targetOffset={300} />
        </div>
    }
```

# Comment ì´ˆê¸° theme ì„¤ì •
- ë³¸ ë¸”ë¡œê·¸ëŠ” ì‚¬ìš©ìê°€ themeì„ ë³€ê²½í•˜ë©´, ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•´ë‘ì—ˆë‹¤ê°€
- ì¬ë°©ë¬¸ì‹œ í•´ë‹¹ themeìœ¼ë¡œ ì ìš©ë˜ë„ë¡ ì„¤ì •ë˜ì–´ìˆì–´ì„œ ì´ˆê¸° themeì„ ì„¤ì •í•´ì£¼ì—ˆë‹¤.
```tsx
import React, { useEffect } from "react"

const COMMENTS_ID = 'comments-container';
// windowê°™ì€ ë¸Œë¼ìš°ì € ì „ì—­ê°ì²´ëŠ” gatsbyë¹Œë“œ ì‹œ, node.jsê°€ í•´ë‹¹ ê°ì²´ë“¤ì„ ê°€ì§€ê³  ìˆì§€ ì•Šì•„ì„œ ë¹Œë“œì—ëŸ¬ê°€ ìƒê¸°ê¸° ë•Œë¬¸ì— ì¡°ê±´ë¬¸ìœ¼ë¡œ ì²˜ë¦¬í•´ì¤˜ì•¼í•¨.
const isBrowser = () => typeof window !== "undefined" 
// ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— themeì„ ê°€ì ¸ì˜´, ì—†ì„ ê²½ìš° ë””í´íŠ¸ëŠ” light
const localTheme =  isBrowser() && window.localStorage.getItem('theme');
const theme = localTheme === 'dark' ? 'photon-dark' : 'github-light';

export default function Comment() {
  useEffect(() => {
      const script = document.createElement('script');
      script.src = 'https://utteranc.es/client.js';
      script.setAttribute('repo', "carrotpieOwO/ha0peno-comment");
      script.setAttribute('issue-term', 'pathname');
      // ê°€ì ¸ì˜¨ theme ë„£ì–´ì£¼ê¸°
      script.setAttribute('theme', theme);
      script.setAttribute('crossorigin', 'anonymous');
      script.async = true;

      const comments = document.getElementById(COMMENTS_ID);
      if (comments) comments.appendChild(script);

      return () => {
          const comments = document.getElementById(COMMENTS_ID);
          if (comments) comments.innerHTML = '';
      };
  }, []);

  return (
      <div id={COMMENTS_ID} />
  );
};
```

# ë™ì ìœ¼ë¡œ theme ë³€ê²½í•˜ê¸°
- `useTheme()` ì»¤ìŠ¤í…€hookì„ í†µí•´ themeì„ ë³€ê²½í•´ì£¼ê³  ìˆì–´ì„œ ê·¸ ì•ˆì— commentí…Œë§ˆë¥¼ ë³€ê²½í•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•´ì£¼ì—ˆë‹¤. 
- utterancesëŠ” `iframe`ìœ¼ë¡œ ìƒì„±ë˜ê¸° ë•Œë¬¸ì— `window.postMessage()`ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ `iframe`ì— ë©”ì„¸ì§€ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤.
- ì´ë¥¼ í™œìš©í•˜ì—¬ `HTMLIframeElement.contentWindow`ì†ì„±ì„ í†µí•´ `iframe`ì— ì ‘ê·¼í•˜ì—¬ í…Œë§ˆê°€ ë³€ê²½ë  ë•Œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•˜ë„ë¡ í•˜ì˜€ë‹¤.
```tsx
const useTheme = () => {
    const localTheme =  isBrowser() && window.localStorage.getItem('theme') as ThemeType;
    const initialTheme = localTheme || 'light' as ThemeType;
    const [ themeMode, setThemeMode ] = useState<ThemeType>(initialTheme);

    const setMode = (mode: ThemeType) => {
        isBrowser() && localStorage.setItem('theme', mode);
        setThemeMode(mode);

        const isComment = document.querySelector('iframe.utterances-frame');
        if (isComment) {
            const utterancesTheme = mode === 'light' ? "github-light" : "photon-dark" ;
            (
              document?.querySelector("iframe.utterances-frame")?.contentWindow.postMessage(
                { type: "set-theme", theme: utterancesTheme },
                "https://utteranc.es/"
              )
            )
        }
    };

    const themeToggler = () => {
        themeMode === 'light' ? setMode('dark') : setMode('light')
    }

    return { themeMode, themeToggler };
}
```
# ê²°ê³¼
![](https://velog.velcdn.com/images/ha0/post/1a5c6666-b439-41da-b98b-8260f6ac07d9/image.gif)
<br/>
<br/>
<br/>
**ğŸ”— references** <br/>
[https://www.sungikchoi.com/blog/gatsby-dark-mode/](https://www.sungikchoi.com/blog/gatsby-dark-mode/)