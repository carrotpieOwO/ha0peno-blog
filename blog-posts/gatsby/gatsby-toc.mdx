---
title: Gatsbyë¸”ë¡œê·¸ì— TOCëª©ì°¨ ì‰½ê²Œ ë§Œë“¤ê¸°
category: Gatsby
date: '2023-03-30'
author: ha0peno
slug: gatsby-toc
thumbnail: gatsby-toc.png
---

# ğŸ° êµ¬í˜„ë°©ë²•
> êµ¬í˜„ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆê² ì§€ë§Œ, ê°€ì¥ ì‰½ê³  ê°„ë‹¨í•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•´ì„œ
> mdxì—ì„œ ìƒì„±ëœ header tagì— **idê°’**ì„ ë¶€ì—¬í•œ ë’¤, <br/>
> scollìœ„ì¹˜ì™€ idê°’ìœ¼ë¡œ ê²€ìƒ‰í•œ headerì˜ ìœ„ì¹˜ê°’ì„ ë¹„êµí•˜ì—¬
> ë§Œë“œëŠ” ë°©ë²•ì„ ì„ íƒí–ˆë‹¤.

## 1. Gatsby-GrapQLì—ì„œ tocë°ì´í„° ë°›ì•„ì˜¤ê¸°
- mdxì˜ headingíƒœê·¸ë¥¼ ë³„ë„ë¡œ ë³µì¡í•˜ê²Œ íŒŒì‹±í•˜ì§€ ì•Šì•„ë„, Gatsbyì—ì„œëŠ” GrapQLë¡œ tableOfContentsë¥¼ ì•Œì•„ì„œ íŒŒì‹±í•´ì¤€ë‹¤.
![](https://velog.velcdn.com/images/ha0/post/5d2d6f19-ed3a-4082-a1da-8dcb464b66bf/image.png)
- ê·¸ë˜ì„œ ì•„ë˜ì™€ ê°™ì´ ìƒì„¸í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ `{mdx.frontmatter__slug}.tsx`ì—ì„œ ì¿¼ë¦¬ë¬¸ì— ì¶”ê°€ë§Œ í•´ì£¼ë©´ ë°ì´í„°ë¥¼ ë°›ì•„ì™€ì„œ ê·¸ëŒ€ë¡œ ì“¸ ìˆ˜ ìˆë‹¤.
```ts
export const query = graphql`
    query BlogDetail($frontmatter__slug:String) {
        mdx(frontmatter: {
            slug: {
                eq: $frontmatter__slug // slugê°’ì´ ì¼ì¹˜í•˜ëŠ” ë°ì´í„°ë§Œ ë°›ì•„ì˜´
            }
        }) {
            body
            frontmatter {
                // í˜ì´ì§€ì— ë¿Œë ¤ì£¼ê¸° ìœ„í•´ ë°›ì•„ì˜¬ ë°ì´í„°ë“¤
                author
                category
                date
                title
                slug
            }
            tableOfContents // ğŸ‘ˆğŸ» toc ëª©ì°¨ ìƒì„±ìš© ë°ì´í„°!
        }
    }
`
```

## 2. heading Elementì— idê°’ ë„£ì–´ì£¼ê¸°
> ìœ„ ì¿¼ë¦¬ë¬¸ì—ì„œëŠ” ìƒì„±ëœ tocì˜ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ìœ„ ë°ì´í„°ë§Œìœ¼ë¡œë„ ëª©ì°¨ëŠ” ìƒì„±í•  ìˆ˜ ìˆì§€ë§Œ, <br/>
> ëª©ì°¨ë¥¼ í´ë¦­í•  ê²½ìš° í•´ë‹¹ headingíƒœê·¸ë¡œ ìŠ¤í¬ë¡¤ì„ ì´ë™í•´ì£¼ì§„ ëª»í•˜ê¸° ë•Œë¬¸ì—
> headingíƒœê·¸ê°€ ìƒì„±ë  ë•Œ **idê°’**ì„ ë¶€ì—¬í•´ì¤˜ì•¼ í•œë‹¤.

- ë‚˜ëŠ” **MDXLayout** ì»´í¬ë„ŒíŠ¸ì—ì„œ `MDXProvider` ë¡œ Gatsbyê°€ ë³€í™˜í•´ì¤€ mdxë¥¼ ê¾¸ë¯¸ê³  ìˆì–´ì„œ ê±°ê¸°ì„œ idê°’ì„ ì¶”ê°€í–ˆë‹¤.
```tsx
const IHeading = ({ children, as }: HeadingProps) => {
    // ë¬¸ìì—´ì—ì„œ ì•ŒíŒŒë²³, ìˆ«ì, í•œê¸€ ë¬¸ìë¥¼ ì œì™¸í•œ ëª¨ë“  ë¬¸ìë¥¼ í•˜ì´í”ˆ('-')ìœ¼ë¡œ ëŒ€ì²´í•˜ì—¬ idê°’ ë¶€ì—¬
    return (
        <Heading id={children.replace(/[^\w\uAC00-\uD7AF]/g, '-')} as={as} padding='2em 0 .5em .5em'>
            {children}
        </Heading>
    )
}

export default function MDXLayout({children} :any) {
    return (
        <MDXProvider
            components={{
                h1: (props:any) => IHeading({...props, as: 'h1'}),
                h2: (props:any) => IHeading({...props, as: 'h2'}),
                h3: (props:any) => IHeading({...props, as: 'h3'}),

// (...ì´í•˜ìƒëµ)
```

## 3. TOCë°ì´í„° êµ¬ì¡° ë§Œë“¤ê¸°
> ìœ„ ì¿¼ë¦¬ë¬¸ì—ì„œ ë°›ì•„ì˜¨ **tableOfContents**ë°ì´í„° êµ¬ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë©´
 h2ëŠ” h1ì˜ ë‚´ë¶€ë¡œ í•œë‹¨ê³„ ë“¤ì–´ê°€ê³ , h3ì€ ë˜ h2ì˜ ë‚´ë¶€ë¡œ ë“¤ì–´ê°€ê¸° ë•Œë¬¸ì— ëª©ì°¨ë¥¼ êµ¬í˜„í•˜ê¸°ê°€ ì˜¤íˆë ¤ ë³µì¡í•´ë³´ì—¬ì„œ
 `flattenItems` ë¼ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì„œ ë‚´ë¶€ itemsë„ ëª¨ë‘ ë°”ê¹¥ìœ¼ë¡œ ë¹¼ì£¼ê³ ,
 ëŒ€ì‹  `sub:true` ì˜µì…˜ì„ ì¤˜ì„œ h2ì´ìƒì€ ëª©ì°¨ì—ì„œ **ë“¤ì—¬ì“°ê¸°**ë¡œ í‘œí˜„í•˜ê¸°ë¡œ í–ˆë‹¤.

```tsx
export default function useToc(data) {
  const flattenItems = (items) => {
    return items.reduce((array, item) => {
      // ëª©ì°¨ì—ì„œ ìŠ¤í¬ë¡¤ì´ë™í•  ìˆ˜ ìˆë„ë¡ idê°’ì€ Elementì˜ idê°’ê³¼ ë™ì¼í•˜ê²Œ íŒŒì‹±í•´ì¤˜ì•¼í•¨.
      array.push({
        id: `${item.title.replace(/[^\w\uAC00-\uD7AF]/g, '-')}`,
        title: item.title
      });
      if (item.items) {
        // í•˜ìœ„ì•„ì´í…œì€ êµ¬ë¶„í•˜ì—¬ ë“¤ì—¬ì“°ê¸°ë¥¼ í•´ì£¼ê¸° ìœ„í•´ subì„¤ì •ì„ ë„£ì–´ì¤€ë‹¤.
        array.push(...item.items.map((child) => ({ 
            id: `${child.title.replace(/[^\w\uAC00-\uD7AF]/g, '-')}`,
            title: child.title,
            sub: true,
        })));
      }
      return array;
    }, []);
  };

  const tocItems = flattenItems(data.mdx?.tableOfContents?.items);
}
```


### ğŸŒ± ë°ì´í„° êµ¬ì¡°
- ì•„ë˜ì™€ ê°™ì´ í”Œë«í•œ êµ¬ì¡°ë¡œ ë§Œë“¤ì–´ ì£¼ì—ˆë‹¤.
![](https://velog.velcdn.com/images/ha0/post/77bee937-fce3-43f7-9fb4-4880840ba136/image.png)

## 4. scrollê´€ë ¨ hook ìƒì„±
- useScroll hookì„ ë§Œë“¤ì–´ì„œ ìŠ¤í¬ë¡¤ìœ„ì¹˜ë¥¼ ì—…ë°ì´íŠ¸í•˜ê³ , ëª©ì°¨ì˜ ìš”ì†Œ í´ë¦­ ì‹œ í•´ë‹¹ headingíƒœê·¸ë¡œ ì´ë™ì‹œì¼œì£¼ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“ ë‹¤.
```tsx
export default function useScrollPosition() {
  const [scrollPosition, setScrollPosition] = useState<number>(0);

  useEffect(() => {
    // scroll ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ì—¬ í˜„ì¬ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤. 
    const handleScroll = () => setScrollPosition(window.scrollY);
    
    window.addEventListener('scroll', handleScroll);
    
    return () => {
      window.removeEventListener('scroll', handleScroll);
    };
  }, []);

  const scrollToEl = (id:string) => {
    // ì „ë‹¬ë°›ì€ idê°’ìœ¼ë¡œ ìŠ¤í¬ë¡¤ì„ ì´ë™ì‹œí‚¨ë‹¤. 
    const element = document.getElementById(id);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth' });
    }
  };

  return { scrollPosition, scrollToEl };
}
``` 

## 5. Scrollìœ„ì¹˜ê°’ì— ë”°ë¼ í™”ë©´ì— ìœ„ì¹˜í•œ heading id êµ¬í•˜ê¸°
```tsx
const {scrollPosition, scrollToEl} = useScrollPosition();

    // ì •ì  htmlíŒŒì¼ì˜ ë¹Œë“œíƒ€ì„ì—ëŸ¬ ë°©ì§€ (nodejsì—ì„œ ë¸Œë¼ìš°ì €ì „ì—­ì„ ì°¸ì¡°í•  ìˆ˜ ì—†ìŒ)
    const isDocument = typeof document !== 'undefined';

    const activeItemId = useMemo(() => {
        // ì „ë‹¬ë°›ì€ hearItemì˜ idê°’ìœ¼ë¡œ ê° í—¤ë”ì˜ offsetTop ê°’ì„ ë°°ì—´ë¡œ ì €ì¥í•œë‹¤.
        const targetOffsets = items.map((item) => {
            const target = isDocument && document.getElementById(item.id);
            return target?.offsetTop ?? Infinity;
        });
        
        // offsetë°°ì—´ì—ì„œ í˜„ì¬ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë³´ë‹¤ offsetì´ í° indexë¥¼ ì°¾ëŠ”ë‹¤. ğŸ‘‰ğŸ» ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë³´ë‹¤ ì•„ë˜ì— ìˆëŠ” divì°¾ê¸°
        const lastIndex = targetOffsets.findIndex((offset) => offset >= scrollPosition);
      
        // ìŠ¤í¬ë¡¤ìœ„ì¹˜ë³´ë‹¤ ì•„ë˜ì— ìˆëŠ” divê°€ ì—†ì„ ê²½ìš° ë§ˆì§€ë§‰ ëª©ì°¨ë¥¼ activeë¡œ ì„¤ì •í•œë‹¤.
        if (lastIndex === -1) {
            return items[items.length - 1]?.id ?? null;
        }

        // lastIndexê°€ ìˆë‹¤ë©´, í•´ë‹¹ ëª©ì°¨ë¥¼ activeë¡œ ì„¤ì •
        return items[lastIndex - 1]?.id ?? items[0]?.id;

    }, [scrollPosition, items]);

```

## 6. TOC ì»´í¬ë„ŒíŠ¸ ìƒì„±
- tocë°ì´í„°ë¡œ ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì„±í•˜ê³ , ìœ„ì—ì„œ êµ¬í•œ activeItemIdê°’ì´ ë¦¬ìŠ¤íŠ¸ê°€ ê°€ì§€ê³ ìˆëŠ” ë°ì´í„°ì˜ idê°’ê³¼ ì¼ì¹˜í•˜ëŠ” ìš”ì†Œì— ë‹¤ë¥¸ ìƒ‰ì„ ì…í˜€ì£¼ê³ ,
- `sub:true`ì¸ ìš”ì†ŒëŠ” `marginLeft`ê°’ì„ ì¤˜ì„œ ë“¤ì—¬ì“°ê¸°ë¥¼ í•´ì£¼ê³ ,
- í´ë¦­ ì‹œ ìŠ¤í¬ë¡¤ì´ë™ì„ ì‹œì¼œì£¼ì—ˆë‹¤.
- ì°¸ê³ ë¡œ tocì»´í¬ë„ŒíŠ¸ê°€ ìŠ¤í¬ë¡¤ì„ ë‚´ë ¤ì˜¬ ë•Œ íŠ¹ì • ìœ„ì¹˜ì— ê³ ì •ë  ìˆ˜ ìˆë„ë¡ tocì»´í¬ë„ŒíŠ¸ëŠ” `position:sticky`ë¡œ ì„¤ì •í•¨.
```tsx
<TList >
    {
        items.map((item) => (
            <ListItem key={item.id} >
                <Box bg={activeItemId === item.id ? 'rgba(254, 215, 226, .5)' : '-moz-initial'} 
                    maxWidth='90%' paddingY='1' 
                    borderLeft='3px solid'
                    borderLeftColor={activeItemId === item.id ? 'pink.300' : 'pink.100'}
                    paddingX={5}
                    onClick={() => scrollToEl(item.id)}
                    cursor='pointer'
                >
                    <Text marginLeft={item.sub ? 2 : 0} 
                        fontSize='sm' overflow='hidden' whiteSpace='nowrap' textOverflow='ellipsis'>
                            { item.title }
                    </Text>
                </Box>
            </ListItem>
        ))
    }
</TList>
```

# ğŸ° ê²°ê³¼
 ê·€ì—½ê²Œ ì˜ ë§Œë“¤ì–´ì§„ ê²ƒ ê°™ë‹¤!! ğŸ¤­
![](https://velog.velcdn.com/images/ha0/post/06bc085b-dff7-4b23-93d2-a3d7c276c4bb/image.gif)

